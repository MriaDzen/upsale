name: DEPLOY_CHERRY

on: registry_package

jobs:
  deploy:
    runs-on: 
      - self-hosted
      - cherry
    
    steps:
    - uses: actions/checkout@v2
    - uses: azure/docker-login@v1
      with:
        login-server: docker.pkg.github.com
        username: ${ GITHUB_ACTOR }
        password: ${{ secrets.PACKAGE_REGISTRY_TOKEN }}
    - name: stop application
      run: docker-compose down
    - name: migrate database
      run: docker-compose up migration
    - name: start application
      run: docker-compose up -d admin bot-client